# 🚀 Video Anonymizer - High Performance (YOLO Pose + GPU Optimization)

대량 영상에서 **팔꿈치/눈** 등 특정 부위를 자동 비식별화(모자이크/블러)하는 **고성능 최적화 버전**입니다. CPU와 GPU 자원을 최대한 활용하는 병렬 처리 아키텍처를 적용하여, 이전 버전 대비 **10배 이상**의 성능 향상을 달성했습니다.

## ⚡ 최종 성능

- **최고 처리 속도**: **96.48 FPS** (`speed` 파이프라인 기준)
- **고품질 처리 속도**: **69.52 FPS** (`ultra` 파이프라인 기준)
- **자원 활용**: CPU 및 GPU 사용률 극대화
- **아키텍처**: 멀티스레딩 및 비동기 처리를 통한 병렬 파이프라인

## 🚀 빠른 시작

프로젝트의 모든 기능은 `Makefile`을 통해 쉽게 사용할 수 있습니다.

### 1. Docker 이미지 빌드 (최초 1회)
```bash
make build
```

### 2. 데모 영상 다운로드 (선택 사항)
```bash
make demo
```

### 3. 고성능 파이프라인 실행 (GPU 필수)

**옵션 1: 품질 우선 (권장)**
```bash
# 기본 설정으로 실행 (입력: data/20140413.mp4)
make run-ultra

# 파일 지정 및 품질 조정하여 실행
make run-ultra IN=my_video.mp4 OUT=result.mp4 CONFIDENCE=0.25 SAFETY_MARGIN=15
```

**옵션 2: 속도 우선**
```bash
# 기본 설정으로 실행
make run-speed

# 파일 지정 및 배치 크기 조정하여 실행
make run-speed IN=my_video.mp4 BATCH_SIZE=64
```

## 🔧 실행 옵션 상세

`make` 명령어 실행 시 다음 파라미터를 지정할 수 있습니다.

- `IN`: 입력 영상 경로 (기본값: `data/20140413.mp4`)
- `OUT`: 출력 영상 경로 (파이프라인에 따라 자동 지정)
- `CONFIDENCE`: 탐지 민감도 (값이 낮을수록 더 많이 탐지, 기본값: `ultra`=0.3, `speed`=0.5)
- `SAFETY_MARGIN`: 마스킹 영역의 여백 (px 단위, 기본값: 12)
- `BATCH_SIZE`: GPU 배치 크기 (기본값: `ultra`=16, `speed`=32)

## 📊 파이프라인 비교

| 파이프라인 | `make` 명령어 | 특징 | 처리 속도 (예시) | 사용 시점 |
| :--- | :--- | :--- | :--- | :--- |
| **Ultra** | `make run-ultra` | 모든 프레임을 정밀하게 분석하여 **품질**에 중점 | ~70 FPS | 높은 정확도가 필요할 때 (권장) |
| **Speed** | `make run-speed` | 일부 눈 검출을 건너뛰어 **최고 속도**에 중점 | ~97 FPS | 빠른 처리가 가장 중요할 때 |
| **기본** | `make run` | CPU 기반의 단일 스레드 처리 | ~5 FPS | GPU가 없는 환경 |

## ⚠️ 주의사항
- Haar 기반 눈 검출은 조명/각도에 민감합니다. 정확도보다 속도 개선에 중점을 두었습니다.
- 팔꿈치는 **YOLOv8-pose**의 키포인트 결과에 의존하며, 새로운 아키텍처에서 처리 속도가 크게 향상되었습니다.